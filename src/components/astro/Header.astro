---
import { NAV_ITEMS, SITE } from '../../lib/constants';

const currentPath = Astro.url.pathname;
---

<header
  class="fixed top-0 z-50 w-full"
  transition:persist
>
  <!-- 顶部磨砂玻璃导航栏 -->
  <nav class="glass mx-auto mt-4 flex max-w-4xl items-center justify-between rounded-2xl px-6 py-3 mx-4 sm:mx-auto">
    <!-- Logo -->
    <a
      href="/"
      class="font-(family-name:--font-display) text-lg font-bold text-(--color-text-primary) transition-colors hover:text-(--color-accent-gold)"
    >
      {SITE.name}
    </a>

    <!-- 桌面端导航链接 -->
    <div class="hidden items-center gap-1 sm:flex">
      {NAV_ITEMS.map((item) => {
        const isActive = currentPath === item.href ||
          (item.href !== '/' && currentPath.startsWith(item.href));
        return (
          <a
            href={item.href}
            class:list={[
              'relative rounded-lg px-3 py-2 text-sm font-medium transition-all duration-200',
              isActive
                ? 'text-(--color-accent-gold)'
                : 'text-(--color-text-secondary) hover:text-(--color-text-primary) hover:bg-(--color-bg-elevated)',
            ]}
          >
            {item.label}
            {isActive && (
              <span class="absolute bottom-0 left-1/2 h-0.5 w-4 -translate-x-1/2 rounded-full bg-(--color-accent-gold)" />
            )}
          </a>
        );
      })}
    </div>

    <!-- 移动端菜单按钮 -->
    <button
      id="mobile-menu-btn"
      class="flex items-center justify-center rounded-lg p-2 text-(--color-text-secondary) transition-colors hover:bg-(--color-bg-elevated) hover:text-(--color-text-primary) sm:hidden"
      aria-label="打开菜单"
    >
      <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </nav>

  <!-- 移动端菜单面板 -->
  <div
    id="mobile-menu"
    class="glass fixed inset-x-4 top-20 z-50 hidden rounded-2xl p-4 sm:hidden"
  >
    <div class="flex flex-col gap-1">
      {NAV_ITEMS.map((item) => {
        const isActive = currentPath === item.href ||
          (item.href !== '/' && currentPath.startsWith(item.href));
        return (
          <a
            href={item.href}
            class:list={[
              'rounded-lg px-4 py-3 text-sm font-medium transition-all duration-200',
              isActive
                ? 'bg-(--color-bg-elevated) text-(--color-accent-gold)'
                : 'text-(--color-text-secondary) hover:bg-(--color-bg-elevated) hover:text-(--color-text-primary)',
            ]}
          >
            {item.label}
          </a>
        );
      })}
    </div>
  </div>
</header>

<script>
  function setupMobileMenu() {
    const btn = document.getElementById('mobile-menu-btn');
    const menu = document.getElementById('mobile-menu');
    if (!btn || !menu) return;

    btn.addEventListener('click', () => {
      menu.classList.toggle('hidden');
    });

    // 点击外部关闭
    document.addEventListener('click', (e) => {
      if (!btn.contains(e.target as Node) && !menu.contains(e.target as Node)) {
        menu.classList.add('hidden');
      }
    });
  }

  // 首次加载和 View Transition 后都执行
  setupMobileMenu();
  document.addEventListener('astro:after-swap', setupMobileMenu);
</script>
